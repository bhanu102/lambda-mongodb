![Untitled Diagram drawio](https://user-images.githubusercontent.com/75179972/187071084-fad51144-a8d4-4899-a533-4fd3a9db6176.png)

# Backend API

Creating a REST API that invokes the Lambda Function through API gateway to perform CRUD operations on Mongodb using Serverless Framework


## Guidelines
- Design a REST API alongwith a token authentication mechanism.
- Users passing a valid token can only access the endpoint
- Logging should also be done as to which user has accessed the api and it should be printed in the logs
- Deploy the API using AWS services like Lambda(preferred) and API gateway(preferred) or EC2
- Select a suitable database to store the data , maybe mongoDB 

## API Reference

- #### Post item

```http
  POST /api/v1/addSensorType
```
{
    “sensorName” → type: string
   “groupId” → type : string (must be unique for every different type of sensor)(length 10 digit)
This field  should be autogenerated and must not be passed by the user
    
}

- #### Delete item

```http
  POST /api/v1/deleteSensorType/groupId/{id}
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `id`      | `integer` | **Required**. Id of item to delete |

{
    “id” → type: integer
}

## Deployment

- Configure AWS IAM credentials
```
sls config credentials --key AKIAIOSFODNN7EXAMPLE --secret wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
```
- Create a SLS Project
```
sls create --template aws-python3 --name lambda-mongodb --path lambda-mongodb
```
- Before deploying make sure you have created the mongodb and add the username and password to access in the lambda function code.
- Create a Cognito User Pool and Add it in **yml/autorizer.yml** file
- Deploy the Project
```
sls deploy -s prod
```
- To completely remove the deployed resources
```
sls remove -s prod
```


## Reference

- [Serverless Framework Commands - AWS Lambda - Config Credentials](https://www.serverless.com/framework/docs/providers/aws/cli-reference/config-credentials)
- [Serverless Framework: Plugins](https://www.serverless.com/plugins/serverless-python-requirements)
- [Serverless Framework - AWS Lambda Functions](https://www.serverless.com/framework/docs/providers/aws/guide/functions)
- [Serverless Framework - AWS Lambda Events - REST API (API Gateway v1)](https://www.serverless.com/framework/docs/providers/aws/events/apigateway#http-endpoints-with-custom-authorizers)
- [Serverless Framework - AWS Lambda Layers](https://www.serverless.com/framework/docs/providers/aws/guide/layers)
- [Getting Started with serverless Framework |API Gateway and lambda | Lab 7 - YouTube](https://www.youtube.com/watch?v=fPxos27jOFE&t=0s&ab_channel=SoumilShah)
- [How to install External Python library such as Pandas on AWS lambda using serverless framework #2 - YouTube](https://www.youtube.com/watch?v=qVk1L7MHjGM&ab_channel=SoumilShah)
- [Rapidly create deploy python library on AWS Layers in Minutes with serverless framework #3 - YouTube](https://www.youtube.com/watch?v=lC489CpKg-s&ab_channel=SoumilShah)
- [Deploying AWS Lamba Function & Layer with Serverless Framework | by Fernando López | Towards Data Science](https://towardsdatascience.com/deploying-aws-lamba-function-layer-with-serverless-framework-f3f4fab1b7e9)
- [Logging Amazon Cognito API calls with AWS CloudTrail](https://docs.aws.amazon.com/cognito/latest/developerguide/logging-using-cloudtrail.html)
- [Analyzing Amazon Cognito CloudTrail events with Amazon CloudWatch Logs Insights - Amazon Cognito](https://docs.aws.amazon.com/cognito/latest/developerguide/analyzingcteventscwinsight.html)
- [How to Create a Highly Secure MongoDB and Lambda Connection? - YouTube](https://www.youtube.com/watch?v=kWhIwlNkZm4&t=9s&ab_channel=EnlearAcademy)
- [Connecting to MongoDB Atlas with Python-PyMongo | by Soumi Bardhan | Analytics Vidhya | Medium](https://medium.com/analytics-vidhya/connecting-to-mongodb-atlas-with-python-pymongo-5b25dab3ac53)
- [Learn in Very easy way How to use AWS Cognito with API gateway and Lambda and secure your with JWT - YouTube](https://www.youtube.com/watch?v=vO1okl3JrRo&ab_channel=SoumilShah)
- [How to Set Up AWS Cognito Authentication with Serverless and NodeJS (freecodecamp.org)](https://www.freecodecamp.org/news/aws-cognito-authentication-with-serverless-and-nodejs/)
- [How to fetch data from MongoDB using Python? - GeeksforGeeks](https://www.geeksforgeeks.org/how-to-fetch-data-from-mongodb-using-python/)
- [db.collection.find() — MongoDB Manual](https://www.mongodb.com/docs/manual/reference/method/db.collection.find/)
- [Convert PyMongo Cursor to JSON - GeeksforGeeks](https://www.geeksforgeeks.org/convert-pymongo-cursor-to-json/)
- [Convert MongoDB Document to JSON using Python (etutorialspoint.com)](https://www.etutorialspoint.com/index.php/294-convert-mongodb-document-to-json-using-python)
- [Python MongoDB - Introduction](https://www.tutorialspoint.com/python_data_access/python_mongodb_introduction.htm)
- [AWS Lambda - get query parameters, request body using Python environment - YouTube](https://www.youtube.com/watch?v=mFzr8IECehw&ab_channel=MohamedNajiAboo)
